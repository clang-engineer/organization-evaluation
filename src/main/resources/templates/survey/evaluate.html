<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{/layout/layoutSurvey}">
<!-- div content -->
<div layout:fragment="content">
    <!-- container -->
    <div class="container">
        <!-- Page Heading/Breadcrumbs -->
        <h1 class="mt-5 mb-3">Blog Home One
            <small>Subheading</small>
        </h1>
        <!-- form -->
        <form id="f1" method="POST" th:action="@{submit}">
            <!-- card -->
            <div class="card mb-4">
                <h5 class="card-header text-white bg-dark">객관식
                    <small class="float-md-right">[[${evaluated}]] 님에 대한 객관식 질의 입니다.</small>
                </h5>
                <div class="card-body mt-2 ml-3" th:each="category:${category}">
                    <h5 class="card-title mb-4 ml-1">[[${category}]]</h5>
                    <div class="ml-3 mb-5" th:each="question,status:${questionList}" th:if="${category}==${question[1]}">
                        <h6 class="card-text mb-4">
                            [[${question[0]}]] - [[${question[2]}]]
                        </h6>
                        <div th:each="book:${book}" class="mr-5 question">
                            <label>
                                <!-- <input th:name="'q'+${status.count}" type="radio" th:value="${status.count}"> -->
                                <input class="mr-2 mb-3" th:name="'q'+${status.count}" type="radio" required th:value="${status.count}">
                                [[${book}]]
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ./card -->
            <!-- card -->
            <div class="card mb-3 essay">
                <h5 class="card-header text-white bg-dark">주관식
                    <small class="float-md-right">[[${evaluated}]] 님에 대한 주관식 질의 입니다.</small>
                </h5>
                <h6 class="card-body mt-2 ml-2" th:each="question, status:${commentList}">
                    <div class="card-text mb-4">[[${status.count}]] - [[${question}]]</div>
                    <!-- <textarea required th:name="'c'+${status.count}" class="form-control" rows="4"></textarea> -->
                    <textarea required th:name="'comment[\'c'+${status.count}+'\']'" class="form-control" rows="4"></textarea>
                    <p class="float-md-right" id="count_message">2000/2000</p>
                </h6>
            </div>
            <!-- ./card -->
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
        </form>
        <!-- ./form -->
        <div class="mt-3 mb-5 justify-content-md-center">
            <button id="btnSubmit" type="submit" class="btn btn-block btn-primary btn-lg">Sumbit</button>
        </div>
        <!-- button -->
        <div class="row fixedbutton">
            <div class="col-md-2">
                <div class="btn-group-vertical btn-group-lg">
                    <button class="btn btn-default"><i class="fas fa-pause-circle fa-3x"></i></button>
                    <button class="btn btn-default"><i class="fas fa-list fa-3x"></i></button>
                </div>
            </div>
        </div>
        <!-- button -->

    </div>
    <!-- ./container -->
</div>
<!-- ./div content -->

</html>
<th:block layout:fragment=" script">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script th:inline="javascript">
        /* documnet ready function */
        $(document).ready(function (e) {
            var formObj = $("#f1");
            var csrf = JSON.parse('[[${_csrf}]]');


            //글자 수 카운터
            $(".essay").on("keyup", "textarea", function (e) {
                var maxLength = 2000;
                var length = $(this).val().length;
                var length = maxLength - length;
                $(this).next().html(length + "/2000");
            });


            //버튼 크기 조정을 위한 클래스 부여
            $(window).on('resize', function () {
                var win = $(this);
                if (win.width() < 768) {
                    console.log(1);
                    $('.btn-group-vertical').addClass('btn-group-sm');
                    $('.btn-group-vertical').removeClass('btn-group-xs');
                    $('.btn-group-vertical').removeClass('btn-group-lg');

                } else if ((win.width() < 1200)) {
                    $('.btn-group-vertical').removeClass('btn-group-sm');
                    $('.btn-group-vertical').addClass('btn-group-xs');
                    $('.btn-group-vertical').removeClass('btn-group-lg');

                } else {
                    $('.btn-group-vertical').removeClass('btn-group-sm');
                    $('.btn-group-vertical').removeClass('btn-group-xs');
                    $('.btn-group-vertical').addClass('btn-group-lg');
                }
            });

            //전송 버튼 눌렀을 때의 동작
            $("#btnSubmit").click(function (e) {
                e.preventDefault();
                // formObj[0].checkValidity();
                // formObj[0].reportValidity();
                console.log($("form").serializeArray());
                formObj.submit();
            })
        });
        /* documnet ready function */

        //make serializeObject는 serializeArray **https://kingbbode.tistory.com/28
        jQuery.fn.serializeObject = function () {
            var obj = null;
            try {
                if (this[0].tagName && this[0].tagName.toUpperCase() == "FORM") {
                    var arr = this.serializeArray();
                    if (arr) {
                        obj = {};
                        jQuery.each(arr, function () {
                            obj[this.name] = this.value;
                        });
                    }
                }
            } catch (e) {
                alert(e.message);
            } finally { }
            return obj;
        }
        //./make serializeObject는 serializeArray **https://kingbbode.tistory.com/28

    </script>
</th:block>