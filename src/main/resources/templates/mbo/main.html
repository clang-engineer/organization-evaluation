<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{/layout/layoutMBO}">
<!-- div content -->
<div layout:fragment="content">

    <!-- Page Content -->
    <div class="container">
        <!-- Page Heading/Breadcrumbs -->
        <h2 class="mb-5">MBO Overall info
            <small>Subheading</small>
        </h2>
        <div class="row">
            <!-- Blog Entries Column -->
            <div class="col-md-8">
                <!-- Blog Post -->
                <div class="card mb-4">
                    <!-- card-body -->
                    <div class="card-body mb-1">
                        <h4 class="card-title">
                            [[${turn?.infoMBO?.title}]]
                        </h4>
                        <p class="card-text">
                            - [[${turn?.title}]]
                        </p>
                        <hr>
                        <p class="card-text" th:utext="${turn?.infoMBO?.content}"></p>
                        <a id="surveyStart" th:href="@{list(company=${companyInfo?.id},tno=${turn?.tno})}" class="btn btn-primary mt-3" data-toggle="tooltip" data-placement="right"
                            title="click!!">Survey start &rarr;</a>
                    </div>
                    <!-- ./card-body -->
                    <div class="card-footer text-muted" th:text="${#calendars.format(#calendars.createNow())}">
                    </div>
                </div>
                <!-- ./Blog Post -->
            </div>  
            <!-- Blog Entries Column -->    


            <!-- Sidebar Widgets Column -->
            <div class="col-md-4">

                <!-- Categories Widget -->
                <div class="card mb-4" th:if="${department}!=null">
                    <h5 class="card-header dep-card" data-html="true" data-toggle="tooltip" data-placement="right" title="목표를 팀원들과 <br> 공유 합니다.">Deparment</h5>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-12">
                                    <ul class="list-unstyled mb-0">
                                        <li th:each="department,index:${department}">
                                            [[${department.department1}]] - [[${department.department2}]]
                                            팀 목표 설정<button th:data-dno="${department.dno}" class="department btn btn-default"><i class="fas fa-chalkboard-teacher"></i></button>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--./ Categories Widget -->

                <!-- Search Widget -->
                <div class="card mb-4" style="align-content: center">
                    <h5 class="card-header">MBO Period</h5>
                    <div class="card-bod p-0">
                    <table class="table table-borderd text-nowrap">
							<thead class="">
								<tr>
									<!-- <th scope="col">Plan</th>
									<th scope="col">Do</th>
									<th scope="col">See</th> -->
								</tr>
							</thead>
							<tbody>
                                <tr>
                                    <th scope="col" class="align-middle">전체기간</th>
                                    <td class="align-middle">
                                        <span th:text="${#temporals.format(turn?.infoMBO?.startDate, 'yy/MM/dd')}">startTime</span>
                                        ~
                                        <span th:text="${#temporals.format(turn?.infoMBO?.endDate, 'yy/MM/dd')}">EndTime</span>
                                    </td>
                                </tr>
                                <tr id="step1">
                                    <th scope="col" class="align-middle">Plan(목표설정)</th>
                                    <td class="align-middle">
                                        <span th:text="${#temporals.format(turn?.infoMBO?.step1Start, 'MM-dd')}">startTime</span>
                                        ~
                                        <span th:text="${#temporals.format(turn?.infoMBO?.step1End, 'MM-dd')}">EndTime</span>
                                    </td>
								</tr>
                                <tr id="step2">
                                    <th scope="col" class="align-middle">Do(목표수행)</th>
                                    <td class="align-middle">
                                        <span th:text="${#temporals.format(turn?.infoMBO?.step2Start, 'MM-dd')}">startTime</span>
                                        ~
                                        <span th:text="${#temporals.format(turn?.infoMBO?.step2End, 'MM-dd')}">EndTime</span>
                                    </td>
								</tr>
                                <tr id="step3">
                                    <th scope="col" class="align-middle">See(목표평가)</th>
                                    <td class="align-middle">
                                        <span th:text="${#temporals.format(turn?.infoMBO?.step3Start, 'MM-dd')}">startTime</span>
                                        ~
                                        <span th:text="${#temporals.format(turn?.infoMBO?.step3End, 'MM-dd')}">EndTime</span>
                                    </td>
								</tr>
							</tbody>
                        </table>
                    </div>
                </div>
                <!--./ Search Widget -->


                
                <!-- Side Widget -->
                <div class="card my-4">
                    <h5 class="card-header">Help</h5>
                    <div class="card-body">
                            <p class="card-text">
                            <label for="">
                                인사 정보 관련 문의 : 
                            </label>
                            <br>[[${companyInfo.hrManager}]] ([[${companyInfo.name}]])
                            <br>Tel : [[${companyInfo.hrManagerTel}]] 
                            </p>
                            <p class="card-text m-0">
                            <label for="">
                                시스템 관련 문의 : 
                            </label>
                            <br>김영준
                            </p>
                            <button id="instructionBtn" class="btn btn-xs float-md-right" data-toggle="tooltip" data-placement="right" title="click!!"><i class="fas fa-book-reader mr-2"></i>Survey instrunction</button>
                    </div>
                </div>
                <!-- ./Side Widget -->
            </div>
            <!--./ Sidebar Widgets Column -->
        </div>
        <!-- /.row -->

    </div>
    <!-- /.container -->

    <div th:insert="~{common/modal::instruction}"></div>
    <div th:insert="~{common/modal::content}"></div>
</div>
<!-- ./div content -->




<th:block layout:fragment="script">
    <script type="text/javascript" src="/public/js/department.js"></script>
    <script th:inline="javascript">
        $(document).ready(function (e) {
            var csrf = JSON.parse('[[${_csrf}]]');

            //modal 사용 변수 선언
            var modal = $("#contentModal");
            var modalTitle = modal.find("#modalTitle");
            var modalBody = modal.find("#modalBody");
            var modalLabel1 = modal.find("#modalLabel1");
            var modalLabel2 = modal.find("#modalLabel2");
            var modalContent1 = modal.find("input[name='modalContent1']");
            var modalContent2 = modal.find("textarea[name='modalContent2']");
            var modalGroupContent1 = modal.find("#content1");
            var modalGroupContent2 = modal.find("#content2");
            var modalModifyBtn = $("#modalModifyBtn");
            var modalRemoveBtn = $("#modalRemoveBtn");
            var modalRegisterBtn = $("#modalRegisterBtn");
            var modalCloseBtn = $("#modalCloseBtn");

            modalTitle.text("팀 목표 입력");
            modalLabel1.text("Title");
            modalLabel2.text("Content");

            modal.find("#content2").append("<p class='float-md-right mb-0' id='count_message'>0/2000</p>");
            modal.find("#content3").remove();

            // 모달 button
            modal.find("button[id!='modalCloseBtn']").hide();
            modalRegisterBtn.show();

            //mbo 기간 정보 표시
            var status = [[${ turn.infoMBO.status }]];
            switch (status) {
                case "plan":
                    $("#step1").attr("class", "table-info").attr("data-toggle", "tooltip").attr("data-placement", "right").attr("title", "현재 진행 중인 단계 입니다.");
                    break;
                case "do":
                    $("#step2").attr("class", "table-info").attr("data-toggle", "tooltip").attr("data-placement", "right").attr("title", "현재 진행 중인 단계 입니다.");
                    break;
                case "see":
                    $("#step3").attr("class", "table-info").attr("data-toggle", "tooltip").attr("data-placement", "right").attr("title", "현재 진행 중인 단계 입니다.");
                    break;
            }


            $("#instructionBtn").click(function (e) {
                $("#instructionModal").modal("show");
                $(".modal-content, .modal-dialog").css("height", "85%");
                $(".modal-body").css("overflow-y", "scroll").css("max-height", "calc(100% - 120px)");
            });

            //toolitip에 관한 설정
            $('#instructionBtn,#surveyStart,.dep-card,#step1,#step2,#step3').tooltip('show');
            //몇초 후에 사라짐
            setTimeout(function () {
                $('#instructionBtn,#surveyStart,.dep-card').tooltip('hide');
            }, 2500);

            $(".department").click(function (e) {

                dno = $(this).data('dno');
                departmentService.read(dno, function (result) {
                    modalTitle.text(result.department1 + " - " + result.department2 + "팀 목표 설정");
                    modalContent1.val(result.leader.title);
                    modalContent2.text(result.leader.content).keyup();
                });

                //모달 data
                modal.data("dno", dno);
                modal.modal("show");
            });

            modalRegisterBtn.click(function (e) {
                dno = modal.data("dno");
                var param = {
                    dno: dno,
                    title: modalContent1.val(),
                    content: modalContent2.val(),
                    csrf: csrf
                }

                departmentService.modify(param, function (result) {
                    alert("수정 되었습니다.");
                    modal.modal("hide");
                });
            });

            //close button click 시
            modalCloseBtn.on("click", function (e) {
                modal.modal('hide');
            });


            //글자 수 카운터
            modalGroupContent2.on("keyup", "textarea", function (e) {
                var maxLength = 2000;
                var length = $(this).val().length;
                $(this).next().html(length + "/2000");
            });

        });
    </script>
</th:block>

</html>