<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{/layout/layoutCompany}">

<div layout:fragment="content">
	<!-- Begin Page Content -->
	<div class="container-fluid">

		<h1 class="mt-4">Company List</h1>
		<!-- Page Heading -->
		<p class="mb-4">
			DataTables is a third party plugin that is used to generate the demo table below. For more information about DataTables, please visit the
			<a target="_blank" href="https://datatables.net">official DataTables documentation</a>
		</p>

		<!-- DataTales Example -->
		<div class="card shadow mb-4">
			<div class="card-header py-3">
				<h4 class="m-0 font-weight-bold text-primary" style="display:inline">Company Tables</h4>
				<!-- serarch box -->
				<div style="float:right">
					<div class="input-group">
						<select class="form-control col-sm-4" id="searchType">
							<option>---
								</optinon>
							<option value="id" th:selected="${pageVO.type}=='id'">ID</option>
							<option value="name" th:selected="${pageVO.type}=='name'">Name</option>
						</select>
						<input type="text" class="col-sm-7 form-control bg-light small" id="searchKeyword" th:value="${pageVO.keyword}" placeholder="Search for...">
						<div class="input-group-append">
							<button class="btn btn-primary" id="searchBtn" type="button">
								<i class="fas fa-search fa-sm"></i>
							</button>
						</div>
					</div>
				</div>
				<!-- /serarch box -->
			</div>


			<div class="card-body">

				<div class="table-responsive">

					<table th:with="result=${result.result}" class="table table table-striped table-bordered" id="dataTable" width="100%" cellspacing="0">

						<thead>
							<tr>
								<th>#No</th>
								<th>Name</th>
								<th>Id</th>
								<th>Password</th>
								<th>Write Date</th>
								<th>Update Date</th>
								<th>Company Info</th>

							</tr>
						</thead>
						<tbody>
							<tr th:each="company:${result.content}">
								<td>[[${company.cno}]]</td>
								<td><a class="surveyList" th:href="${company.cno}">[[${company.name}]]</a></td>
								<td>[[${company.id}]]</td>
								<td>[[${company.password}]]</td>
								<td>[[${#dates.format(company.writeDate,'yyyy-MM-dd hh:mm:ss')}]]</td>
								<td>[[${#dates.format(company.updateDate,'yyyy-MM-dd hh:mm:ss')}]]</td>
								<td><a th:href="${company.cno}" class="companyDetail">
										<button type="button" class="btn btn-info">Detail</button>
									</a></td>
							</tr>
						</tbody>
					</table>


				</div>

				<!-- page nation -->
				<nav aria-label="Page navigation example">
					<ul class="pagination justify-content-end">
						<li class="page-item" th:if="${result.prevPage}">
							<a class="page-link" th:href="${result.prevPage.pageNumber}+1" tabindex="-1">Prev</a>
						</li>
						<li class="page-item" th:classappend="${p.pageNumber==result.currentPageNum-1}?active:'' " th:each="p:${result.pageList}">
							<a class="page-link" th:href="${p.pageNumber}+1">[[${p.pageNumber}+1]]</a>
						</li>
						<li class="page-item" th:if="${result.nextPage}">
							<a class="page-link" th:href="${result.nextPage.pageNumber}+1">Next</a>
						</li>
					</ul>
				</nav>
				<!--/ page nation -->

			</div>
		</div>

	</div>

	<form id="f1" th:action="@{list}" method="get">
		<input type="hidden" name="page" th:value=${result.currentPageNum} />
		<input type="hidden" name="size" th:value=${result.currentPage.pageSize} />
		<input type="hidden" name="type" th:value=${pageVO.type} />
		<input type="hidden" name="keyword" th:value=${pageVO.keyword} />
	</form>

	<!-- modal -->
	<div class="modal fade" id="myModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">Modal title</h4>
				</div>
				<div class="modal-body">처리가 완료되었습니다.</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default border">Close</button>
					<button type="button" class="btn btn-primary">Save changes</button>
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal-dialog -->
	</div>
	<!-- /.modal -->



	<!-- /.container-fluid -->
</div>



<th:block layout:fragment="script">
	<script th:inline="javascript">
	/* 	$(window).load(function() {
	 var msg=[[${msg}]];
	 if(msg=='success'){
	 alert("정상적으로 처리되었습니다.");
	 var stateObj={msg:""};
	 }
	 }); */
	$(document).ready(function() {
	    var formObj = $("#f1");
		
	    //페이지에 붙은 링크 클릭 시
	    $(".pagination a").click(function(e) {
		e.preventDefault();

		formObj.find('[name="page"]').val($(this).attr('href'));
		formObj.submit();
	    });
		
	    //검색 버튼 클릭 시
	    $("#searchBtn").click(function(e) {
		var typeStr = $("#searchType").find(":selected").val();
		var keywordStr = $("#searchKeyword").val();

		formObj.find("[name='type']").val(typeStr);
		formObj.find("[name='keyword']").val(keywordStr);
		formObj.find("[name='page']").val("1");
		formObj.submit();
	    });
		
	    //디테일 버튼 클릭 시
	    $(".companyDetail").click(function(e) {
		e.preventDefault();

		var companyCno = $(this).attr("href");
		formObj.attr("action",[[@{'/company/view'}]]);
		formObj.append("<input type='hidden' name='cno' value='"+companyCno+"'/>");
		formObj.submit();
	    });
	    
	    //제목 클릭 시
	    $(".surveyList").click(function(e) {
		e.preventDefault();

		var companyCno = $(this).attr("href");
		formObj.attr("action",[[@{'surveyList'}]]);
		formObj.append("<input type='hidden' name='cno' value='"+companyCno+"'/>");
		
		formObj.submit();
	    });
	});

	/* 			$(document).ready(function(){
	 var result=[[${result}]];

	 checkModal(result);
	
	 history.replaceState({},null,null);
	
	 function checkModal(result){
	
	 if(result===''||history.state){
	 return;
	 }
	 if(parseInt(result)>0){
	 $(".modal-body").html( result + "번째 정보가 정상적으로 등록 되었습니다.");
	 $("#myModal").modal("show");
	 }				
	 }
	
	 }); */
    </script>
</th:block>
</body>

</html>
